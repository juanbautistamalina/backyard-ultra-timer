(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))s(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function a(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerPolicy&&(n.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?n.credentials="include":t.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(t){if(t.ep)return;t.ep=!0;const n=a(t);fetch(t.href,n)}})();const F={bocina:"/audio/bocina.mp3",alarma:"/audio/alarma.mp3",alarmaFuerte:"/audio/alarma_fuerte.mp3",multitud:"/audio/multitud.mp3"},L={};for(const[e,r]of Object.entries(F))fetch(r).then(a=>a.arrayBuffer()).then(a=>{L[e]=a}).catch(()=>{});const I=[{key:"bocina",at:57*60},{key:"alarma",at:58*60},{key:"alarmaFuerte",at:59*60},{key:"multitud",at:59*60+49}];let u=!1,p=0,f=0,o=null,y=null,h=null,g=new Set,v=0,$=0,w=new Map;const N=document.getElementById("display"),H=document.getElementById("lap"),j=document.getElementById("lapsCompleted"),K=document.getElementById("kilometers"),E=document.getElementById("startBtn"),S=document.getElementById("stopBtn"),R=document.getElementById("resetBtn"),U=document.getElementById("testBtn"),q=document.getElementById("nextAlarmName"),_=document.getElementById("nextAlarmCountdown");E.addEventListener("click",V);S.addEventListener("click",X);R.addEventListener("click",Z);U.addEventListener("click",ee);function A(){return u?f+(performance.now()-p):f}function C(e){const r=Math.floor(e/1e3),a=Math.floor(r/3600),s=Math.floor(r%3600/60),t=r%60;return[a,s,t].map(n=>String(n).padStart(2,"0")).join(":")}function D(e){const r=Math.floor(e/3600),a=r*3600;for(const{key:c,at:d}of I){const l=a+d;if(l>=e-1e-6)return{key:c,timeSec:l}}const s=(r+1)*3600,{key:t,at:n}=I[0];return{key:t,timeSec:s+n}}function G(e){switch(e){case"bocina":return"Bocina (57:00)";case"alarma":return"Alarma (58:00)";case"alarmaFuerte":return"Alarma fuerte (59:00)";case"multitud":return"Multitud (59:49)";default:return"‚Äî"}}function W(){const e=A();N.textContent=C(e);const r=Math.floor(e/1e3),a=Math.floor(r/3600),s=a+1;H.textContent=String(s),j.textContent=String(a),K.textContent=(a*6.7).toFixed(1);const t=e/1e3,n=D(t);q.textContent=G(n.key);const c=Math.max(0,(n.timeSec-t)*1e3);_.textContent=`en ${C(c)}`}(function e(){W(),requestAnimationFrame(e)})();async function Y(){if(o&&y)return;o||(o=new(window.AudioContext||window.webkitAudioContext));const e=async n=>{const c=L[n]||await fetch(F[n]).then(d=>d.arrayBuffer());return new Promise((d,l)=>{o.decodeAudioData(c.slice(0),d,l)})},[r,a,s,t]=await Promise.all([e("bocina"),e("alarma"),e("alarmaFuerte"),e("multitud")]);y={bocina:r,alarma:a,alarmaFuerte:s,multitud:t}}function O(){v=o.currentTime,$=A()/1e3}function z(e){return v+(e-$)}function J(){if(!u||!o||!y)return;const e=5,r=A()/1e3,a=r,s=r+e,t=Math.floor(a/3600),n=Math.floor(s/3600)+1;for(let c=t;c<=n;c++){const d=c*3600;for(const{key:l,at:T}of I){const m=d+T;if(m<a-.001||m>s+.001)continue;const B=`${c}:${l}`;if(g.has(B))continue;const M=z(m);if(!(M<=o.currentTime+.03))try{const b=w.get(B);if(b&&Math.abs(m-b)<1)continue;const i=o.createBufferSource();i.buffer=y[l];const x=o.createGain();x.gain.value=.9,i.connect(x),x.connect(o.destination),i.onended=()=>{try{i.disconnect(),x.disconnect()}catch{}},i.onerror=k=>{console.error(`Audio playback error for ${l}:`,k)},i.start(M),g.add(B),w.set(B,m),console.log(`‚úì Scheduled ${l} for hour ${c} at ${m}s (ctx: ${M.toFixed(3)})`)}catch(b){console.error(`Failed to schedule ${l}:`,b);try{const i=o.createBufferSource();i.buffer=y[l],i.connect(o.destination),i.start(),console.log(`üîÑ Fallback immediate playback for ${l}`)}catch(i){console.error(`Fallback also failed for ${l}:`,i)}}}}}function Q(){h||(h=setInterval(J,50))}function P(){h&&(clearInterval(h),h=null)}async function V(){u||(await Y(),u=!0,p=performance.now(),E.disabled=!0,S.disabled=!1,o.state==="suspended"&&await o.resume(),g.clear(),w.clear(),O(),Q())}async function X(){if(!u)return;const e=f+(performance.now()-p);u=!1,f=e,E.disabled=!1,S.disabled=!0,P(),o&&o.state==="running"&&await o.suspend()}async function Z(){u=!1,f=0,p=0,E.disabled=!1,S.disabled=!0,P(),g.clear(),w.clear(),o&&o.state==="running"&&await o.suspend()}async function ee(){u?(p=performance.now()-336e4,f=0,g.clear(),w.clear(),o&&O()):(f=336e4,p=0),console.log("‚è∞ Timer jumped to 56:00 for testing")}
